var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i['return'])_i['return']()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(){var _window$BlockChainUti=window.BlockChainUtils,myStorage=_window$BlockChainUti.myStorage,setCookie=_window$BlockChainUti.setCookie,getScript=_window$BlockChainUti.getScript;var _window=window,location=_window.location,fetchData=_window.fetchData,emitter=_window.emitter;var HeaderExtend=function(){function HeaderExtend(){_classCallCheck(this,HeaderExtend)}_createClass(HeaderExtend,[{key:'init',value:function init(){var _this=this;this.$commonHeader=document.querySelector('#common-header');this.$headerCusNav=document.querySelector('#header-cus-nav');this.$headerNavEven=document.querySelector('#common-header-linkList');this.$commonHeaderOptionList=document.querySelector('.header-isLogin');this.$headerIsLoginNavEvenTitle=Array.prototype.slice.call(document.querySelectorAll('.header-isLogin-navEven-title'));this.$lanList=Array.prototype.slice.call(this.$commonHeader.querySelectorAll('.lang-list'));this.$loginBtn=this.$commonHeader.querySelector('.header-login-button');this.$registerBtn=this.$commonHeader.querySelector('.header-reg-button');this.headerNavEvenListIn=Array.prototype.slice.call(this.$commonHeader.querySelectorAll('.header-navEven-list'));this.$logOut=this.$commonHeader.querySelector('.logout');this.$colorList=Array.prototype.slice.call(document.querySelectorAll('#colorList li'));this.$appdownLoadCoin=this.$commonHeader.querySelector('.appdownLoad-coin');this.$colorSet=document.querySelector('#color-set');this.colorDialog=null;this.outFlag=true;this.getData();if(!window.BlockChainDialog&&this.dialogPath){getScript(window.staticDomain+'/home/static/'+this.dialogPath).then(function(){_this.initColorDiaolog();_this.bindEvent()})}else{this.initColorDiaolog();this.bindEvent()}}},{key:'bindEvent',value:function bindEvent(){var _this2=this;if(this.$appdownLoadCoin){this.$appdownLoadCoin.addEventListener('click',function(){window.location.href='/appDownload'},false)}if(this.headerNavEvenListIn.length){this.headerNavEvenListIn.forEach(function(ul){Array.prototype.slice.call(ul.querySelectorAll('li')).forEach(function(li){li.addEventListener('mouseover',function(e){var target=e.target;target.className='h-4-bg x-3-cl'},false);li.addEventListener('mouseout',function(e){var target=e.target;target.className='x-2-cl'},false)})})}if(this.$colorSet){this.$colorSet.addEventListener('click',function(){_this2.colorDialog.show()},false)}Array.prototype.slice.call(this.$commonHeader.querySelectorAll('.goMessage')).forEach(function(item){item.addEventListener('click',function(){location.href='/mesage'},false)});if(this.$logOut){this.$logOut.addEventListener('click',function(){if(!_this2.outFlag){return}_this2.outFlag=false;fetchData({url:'/fe-ex-api/user/login_out'}).then(function(data){_this2.outFlag=true;if(data.code.toString()==='0'){emitter.emit('tip',{text:data.msg,type:'success'});location.reload()}else{emitter.emit('tip',{text:data.msg,type:'error'})}})},false)}Array.prototype.slice.call(this.$commonHeader.querySelectorAll('.goPersonal')).forEach(function(item){item.addEventListener('click',function(){location.href='/personal/userManagement'},false)});if(this.$loginBtn){this.$loginBtn.addEventListener('click',function(){location.href='/login'});this.$loginBtn.addEventListener('mouseover',function(){_this2.$loginBtn.className='common-button header-login-button common-button-text-kind u-11-cl u-12-bg'});this.$loginBtn.addEventListener('mouseout',function(){_this2.$loginBtn.className='common-button header-login-button common-button-text-kind u-11-cl'})}this.$registerBtn.addEventListener('click',function(){location.href='/register'});this.$registerBtn.addEventListener('mouseover',function(){_this2.$registerBtn.className='common-button header-reg-button common-button-hollow-big u-8-cl u-8-bd'});this.$registerBtn.addEventListener('mouseout',function(){_this2.$registerBtn.className='common-button header-reg-button common-button-hollow-big u-11-cl u-8-bd '});this.$lanList.forEach(function(item){item.addEventListener('mouseover',function(e){var target=e.target;if(target.tagName==='LI'){target.className='h-4-bg x-3-cl'}});item.addEventListener('mouseout',function(e){var target=e.target;if(target.tagName==='LI'){var lan='null';if(target.dataset&&target.dataset.key){var _target$dataset$key$s=target.dataset.key.split('/');var _target$dataset$key$s2=_slicedToArray(_target$dataset$key$s,2);lan=_target$dataset$key$s2[1]}var newLan=window.location.href.match(/[a-z]+_[A-Z]+/)[0];if(lan===newLan){target.className='h-4-bg x-3-cl'}else{target.className=''}}});item.addEventListener('click',function(e){var target=e.target;var data=target.dataset;if(target.tagName==='LI'){if(data.link){location.href=data.link}else if(data.key){location.href=data.key}}})});this.$headerIsLoginNavEvenTitle.forEach(function(item){item.addEventListener('mouseover',function(e){var target=e.target;if(target.tagName==='DIV'){target.className='header-isLogin-navEven-title x-3-cl'}});item.addEventListener('mouseout',function(e){var target=e.target;if(target.tagName==='DIV'){target.className='header-isLogin-navEven-title'}})});if(this.$headerCusNav){this.$headerCusNav.addEventListener('mouseover',function(e){var target=e.target;if(target.tagName==='A'){target.className='h-4-bg x-3-cl'}},false);this.$headerCusNav.addEventListener('mouseout',function(e){var target=e.target;if(target.tagName==='A'){target.className='x-2-cl g-3-cl-h'}},false)}}},{key:'login',value:function login(){var _this3=this;fetchData({method:'post',url:'/fe-ex-api/common/user_info'}).catch(function(){}).then(function(data){if(data){if(!Number(data.code)){window.isLogin=true;var $loginSet=Array.prototype.slice.call(_this3.$commonHeader.querySelectorAll('.login-set'));var $footerBox=document.querySelector('#footer-box');var $logOut=$footerBox.querySelector('.logout');$loginSet.forEach(function(target){target.style.display='flex'});$logOut.style.display='block';var $unloginSet=Array.prototype.slice.call(_this3.$commonHeader.querySelectorAll('.unlogin-set'));$unloginSet.forEach(function(target){target.style.display='none'});if(_this3.$commonHeader.querySelector('.userText')){_this3.$commonHeader.querySelector('.userText').innerHTML=data.data.userAccount}if(_this3.$commonHeader.querySelector('.userStatus')){_this3.$commonHeader.querySelector('.userStatus').innerHTML=_this3.locale.userStatus+': '+_this3.userState[Number(data.data.accountStatus)]}}window.emitter.emit('login')}})}},{key:'getMessage',value:function getMessage(){var _this4=this;fetchData({url:'/fe-ex-api/message/v4/get_no_read_message_count',method:'post'}).catch(function(error){}).then(function(data){if(data&&!Number(data.code)){if(data.data.noReadMsgCount){var $headerUserMessage=_this4.$commonHeader.querySelector('.header-user-message');_this4.$commonHeader.querySelector('#messageMore').style.display='block';$headerUserMessage.classList.add('message-list');var userMessageList=data.data.userMessageList;var html='';userMessageList.forEach(function(item){html+='<li class="x-2-cl mesageNav">\n                                    '+item.messageContent+'\n                                </li>'});$headerUserMessage.querySelector('.header-user-text').innerHTML=html}}})}},{key:'getData',value:function getData(){this.login();this.getMessage()}},{key:'initColorDiaolog',value:function initColorDiaolog(){this.$colorList.forEach(function(item){if(item.dataset.checked){item.classList.add('checked')}});this.colorDialog=new window.BlockChainDialog({locale:this.locale,content:'<div class="setBox">\n                            <div class="setColor clearfix">\n                                <div class="setColor-key x-2-cl">'+this.locale.color+'</div>\n                                <ul class="setColor-value colorList">\n                                   '+document.querySelector('#colorList').innerHTML+'\n                                </ul>\n                            </div>\n                        </div>',confirm:function confirm(){var $checked=this.dialog.querySelector('.checked');setCookie('cusSkin',$checked.dataset.id);window.location.reload()}});var $DialogColorList=Array.prototype.slice.call(this.colorDialog.dialog.querySelectorAll('.colorList li'));$DialogColorList.forEach(function(item){item.addEventListener('click',function(){if(!item.classList.contains('checked')){$DialogColorList.forEach(function(el){el.classList.remove('checked')});item.classList.add('checked')}})})}}]);return HeaderExtend}();window.HeaderExtend=HeaderExtend})();